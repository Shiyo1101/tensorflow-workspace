# TensorFlow Workspace

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€NVIDIA GPUã‚’æ´»ç”¨ã—ãŸTensorFlowã®æ©Ÿæ¢°å­¦ç¿’é–‹ç™ºã‚’ã€Dockerã¨VS Code Dev Containerã‚’ç”¨ã„ã¦ç°¡å˜ã«è¡Œã†ãŸã‚ã®ç’°å¢ƒã§ã™ã€‚

-----

## âœ… å‰ææ¡ä»¶

ã“ã®é–‹ç™ºç’°å¢ƒã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€ãŠä½¿ã„ã®PCï¼ˆãƒ›ã‚¹ãƒˆOSï¼‰ã«ä»¥ä¸‹ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚è©³ç´°ã¯æ¬¡ã®ã€Œç’°å¢ƒæ§‹ç¯‰æ‰‹é †ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

1.  NVIDIA ãƒ‰ãƒ©ã‚¤ãƒ
2.  Docker
3.  NVIDIA Container Toolkit (Linuxã®ã¿)
4.  Visual Studio Code
5.  Dev Containers æ‹¡å¼µæ©Ÿèƒ½

-----

## ğŸ› ï¸ ç’°å¢ƒæ§‹ç¯‰æ‰‹é †

### 1\. å‰æã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ç¢ºèª

#### 1.1. NVIDIA ãƒ‰ãƒ©ã‚¤ãƒ

  * **èª¬æ˜**: ãƒ›ã‚¹ãƒˆOSãŒNVIDIA GPUã‚’èªè­˜ã—ã€Dockerã‚³ãƒ³ãƒ†ãƒŠãŒGPUã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«**å¿…é ˆã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢**ã§ã™ã€‚
  * **ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**: [NVIDIAå…¬å¼ã‚µã‚¤ãƒˆ](https://www.nvidia.co.jp/Download/index.aspx?lang=jp)ã‹ã‚‰ãŠä½¿ã„ã®GPUã«é©åˆã™ã‚‹æœ€æ–°ã®ãƒ‰ãƒ©ã‚¤ãƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚
  * **ç¢ºèªæ–¹æ³•**: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€GPUã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
    ```bash
    nvidia-smi
    ```

> **CUDA Toolkitã«é–¢ã™ã‚‹æ³¨æ„**
> ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€å¿…è¦ãªCUDAãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯Dockerã‚¤ãƒ¡ãƒ¼ã‚¸å†…ã«å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€é€šå¸¸**ãƒ›ã‚¹ãƒˆOSã«åˆ¥é€”CUDA Toolkitã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚** ä¸Šè¨˜ã®NVIDIAãƒ‰ãƒ©ã‚¤ãƒã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒæœ€ã‚‚é‡è¦ã§ã™ã€‚ã‚‚ã—ã€Dockerä»¥å¤–ã®ç›®çš„ã§ãƒ›ã‚¹ãƒˆOSä¸Šã«CUDA ToolkitãŒå¿…è¦ãªå ´åˆã¯ã€[NVIDIA CUDA Toolkitãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸](https://developer.nvidia.com/cuda-downloads)ã®æŒ‡ç¤ºã«å¾“ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

#### 1.2. Docker

  * **èª¬æ˜**: ã‚³ãƒ³ãƒ†ãƒŠã‚’ç®¡ç†ãƒ»å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚
  * **ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**:
      * **Windows/Mac**: [Docker Desktop](https://www.docker.com/products/docker-desktop/)å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
      * **Linux (Ubuntu)**: Dockerå…¬å¼ã‚µã‚¤ãƒˆã®æ‰‹é †ã«å¾“ã„ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
  * **ç¢ºèªæ–¹æ³•**: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
    ```bash
    docker --version
    ```

#### 1.3. (å­¦å†…é™å®š) Dockerã®ãƒ—ãƒ­ã‚­ã‚·è¨­å®š

  * **èª¬æ˜**: å¤§å­¦ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãªã©ã‚’è¡Œã†å ´åˆã«å¿…è¦ã§ã™ã€‚
  * **è¨­å®šæ–¹æ³•**:
      * **Linux (Ubuntu)**: `~/.docker/config.json`ã«ãƒ—ãƒ­ã‚­ã‚·æƒ…å ±ã‚’è¨˜è¿°ã—ã¾ã™ã€‚
      * **Windows / Mac (Docker Desktop)**: Settings \> Resources \> PROXIES ã‹ã‚‰GUIã§è¨­å®šã—ã¾ã™ã€‚
      * (è©³ç´°ãªæ‰‹é †ã¯çœç•¥ã€‚å¿…è¦ã«å¿œã˜ã¦å‰ã®å›ç­”ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚)

#### 1.4. NVIDIA Container Toolkit (Linuxã®ã¿)

  * **èª¬æ˜**: Linuxä¸Šã§DockerãŒNVIDIA GPUã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã‚­ãƒƒãƒˆã§ã™ã€‚
  * **ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
    ```bash
    curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
      && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \
        sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
        sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
    sudo apt-get update
    sudo apt-get install -y nvidia-container-toolkit
    sudo systemctl restart docker
    ```
  * **ç¢ºèªæ–¹æ³•**: ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ã‚¨ãƒ©ãƒ¼ãªãGPUæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚
    ```bash
    docker run --rm --gpus all nvidia/cuda:12.2.0-base-ubuntu22.04 nvidia-smi
    ```

#### 1.5. Visual Studio Code & Dev Containersæ‹¡å¼µæ©Ÿèƒ½

  * **èª¬æ˜**: é–‹ç™ºç”¨ã‚¨ãƒ‡ã‚£ã‚¿ã¨ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã®é–‹ç™ºã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚ã®æ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚
  * **ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**:
    1.  [Visual Studio Code](https://code.visualstudio.com/)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
    2.  VS Codeã‚’èµ·å‹•ã—ã€æ‹¡å¼µæ©Ÿèƒ½ã‚¿ãƒ–ã‹ã‚‰`ms-vscode-remote.remote-containers`ã‚’æ¤œç´¢ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
  * **ç¢ºèªæ–¹æ³•**: VS Codeã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆ(`Ctrl+Shift+P` or `Cmd+Shift+P`)ã§`Dev Containers:`ã¨å…¥åŠ›ã—ãŸéš›ã«ã€é–¢é€£ã‚³ãƒãƒ³ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

-----

### 2\. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èµ·å‹•

1.  **VS Codeã‚’èµ·å‹•**ã—ã€ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆ (`Ctrl+Shift+P` or `Cmd+Shift+P`) ã‚’é–‹ãã¾ã™ã€‚
2.  `Dev Containers: Reopen in Container` ã‚’æ¤œç´¢ã—ã€é¸æŠã—ã¾ã™ã€‚
3.  è‡ªå‹•çš„ã«Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã¨ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚åˆå›ã¯æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

ãƒ“ãƒ«ãƒ‰ãŒå®Œäº†ã™ã‚‹ã¨ã€VS Codeã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚Œã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã®é–‹ç™ºç’°å¢ƒã«æ¥ç¶šã•ã‚ŒãŸçŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚

-----

### 3\. å‹•ä½œç¢ºèª

ç’°å¢ƒãŒæ­£ã—ãæ§‹ç¯‰ã•ã‚ŒãŸã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚

1.  VS Codeã§ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã¾ã™ (`Ctrl+@` or `Cmd+@`)ã€‚

2.  ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€GPUãŒTensorFlowã«èªè­˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

    ```bash
    python src/test/gpu.py
    ```

**æˆåŠŸæ™‚ã®å‡ºåŠ›ä¾‹:**

```
INFO:tensorflow:âœ… 1å€‹ã®GPUãŒåˆ©ç”¨å¯èƒ½ã§ã™:
INFO:tensorflow:  GPU 0: /physical_device:GPU:0
...
INFO:tensorflow:TensorFlowã®å‹•ä½œç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸã€‚
```

ä¸Šè¨˜ã®ã‚ˆã†ã«GPUãŒåˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹æ—¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯æˆåŠŸã§ã™ã€‚é–‹ç™ºã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼